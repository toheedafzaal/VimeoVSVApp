<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html>
<head>
    <title></title>


    <meta content='IE=Edge' http-equiv='X-UA-Compatible' />
    <script src="https://player.vimeo.com/api/player.js"></script>
    <style>
        #video-container {
            position: absolute;
            /*background-color: black;*/
            border: none;
            top: 0;
            right: 0;
            bottom: 0;
            left: 0;
            width: 100%;
            height: 100%;
        }
    </style>
</head>

<body>

    <div id="video-container"></div>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
    <script>


        
        var videoss = window.external.getVideoIds();
        var ssDbTime = window.external.getStartTime();
        var eeDbTime = window.external.getEndTime();
        var videos = videoss.split(",");
        var savePlaysarr = [];
        var respDblist;
        var arrayVideos = [];
        var isLoadWindow = 0;
        var loopIndex = 0;
        var videotime = [];
        var now = new Date();
        var currentTime = now.toISOString();
        console.log(currentTime);
        var nowDate = currentTime.split('T')[0];
        //var startTime = new Date(nowDate + "T11:55");
        //var endTime = new Date(nowDate + "T13:03");
        var sDbTime = "T";
        sDbTime += ssDbTime;
        var startTime = new Date(nowDate + sDbTime);
        //alert(startTime);
        var eDbTime = "T";
        eDbTime += eeDbTime;
        var endTime = new Date(nowDate + eDbTime);
        ////////
        //if(currenttime>=Starttime&&currenttime<=StopTime){playMovie(null, videos, options);} else{stopplaying or exit};
        var playMovie = function (player, videos, options, startTime, endTime) { // get startTime and endTime
            // get currentTime here
            //debugger;
            now = new Date();
            currentTime = now.toISOString();
            nowDate = currentTime.split('T')[1];
            console.log(Date.parse(currentTime));
            console.log(Date.parse(startTime));
            console.log(Date.parse(endTime));
            // add if-else to check for currentTime is between startTime and endTime
            if (Date.parse(currentTime) > Date.parse(startTime) && Date.parse(currentTime) < Date.parse(endTime)) {
                if (!videos.length) {
                    return false;
                }
                console.log(videos);
                //var video = 'https://vimeo.com/' + videos.shift();
                var video = videos.shift();

                if (!player) {

                    options.url = video;
                    console.log(video, 'video*URL');
                    testid = video;
                    player = new Vimeo.Player('video-container', options);

                    player.play();

                    player.on('ended', function () {

                        playMovie(player, videos, options, startTime, endTime) // pass startTime and endTime
                    })
                } else {
                    console.log(video);

                    testid = video;
                    const idd = video.split("/");

                    var videoid = idd[3];

                    player.loadVideo(videoid)
                        .then(function () {

                            player.play();
                        })
                        .catch(function (error) {
                            console.log(testid + '*');

                            console.warn(error);
                        })
                        .complete(function () { alert("function completed"); })
                        ;
                    //alert("end of load")
                }
                player.getEnded(true).then(function (ended) {

                    if (videos.length == 3) {
                        var respDateTime = GetPlaysTime();
                        videotime.push(respDateTime);
                    }
                    else if (videos.length == 2) {
                        var respDateTime = GetPlaysTime();
                        videotime.push(respDateTime);
                    }
                    else if (videos.length == 1) {
                        var respDateTime = GetPlaysTime();
                        videotime.push(respDateTime);
                    }
                    else if (videos.length == 0) {
                        isLoadWindow = 1;
                        loopIndex++;

                    }
                });
            }
            else {
                console.log("Time is up");
                //alert("Your Business Hours are Completed");
                setInterval(playMovie, 300000, null, videos, options, startTime, endTime);
            }
        }
        function GetPlaysTime() {
            var date = new Date();
            FormatedDate = moment(date).format("yyyy-MM-DDTHH:mm:ss");
            //alert(FormatedDate);
            return FormatedDate;
        }

        var options = {
            width: "1300",
            height: "650"
        };
        playMovie(null, videos, options, startTime, endTime);
    </script>
</body>
</html>